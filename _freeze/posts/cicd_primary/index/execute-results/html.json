{
  "hash": "0bc86bf93126cce5f0f13aae4d67dee9",
  "result": {
    "markdown": "---\ntitle: Updating Quarto Website Daily with GitHub Actions\ndate: '2023-09-07'\ncategories: [CICD, Quarto]\nimage: https://external-content.duckduckgo.com/iu/?u=https%3A%2F%2Fwww.adictosaltrabajo.com%2Fwp-content%2Fuploads%2F2020%2F10%2Fandroid-github-actions-setup-image-35b6a79fea4a7289acb6796cd4ad05b4.png&f=1&nofb=1&ipt=b02a4ecfb6e2d666f35916b643a6f3e9907e880252d1e19d3eda47521252e9c3&ipo=images\ntitle-block-banner: false\nexecute: \n    eval: false\n---\n\n\n![](https://external-content.duckduckgo.com/iu/?u=https%3A%2F%2Fwww.adictosaltrabajo.com%2Fwp-content%2Fuploads%2F2020%2F10%2Fandroid-github-actions-setup-image-35b6a79fea4a7289acb6796cd4ad05b4.png&f=1&nofb=1&ipt=b02a4ecfb6e2d666f35916b643a6f3e9907e880252d1e19d3eda47521252e9c3&ipo=images){fig-align=\"center\"}\n\n#### Introduction\n\nFor my friends who use Quarto, perhaps you need to update a particular blog post daily, weekly, or at some other time interval. You could redeploy your site manually every day, but this would be tedious and inefficient. Another option is to use GitHub actions to help you with this task. For high computational tasks using GitHub Actions can cost money, but rendering a small website and running a small script everything is free!\n\nFor those curious, this problem has surfaced with two of my previous posts: [my election model](/./projects/election_model/index.qmd) and [the google trends primary tracker](/./posts/primary_stream/index.qmd). For my election model, I used the tedious, inefficient approach back in 2020 (manually running and updating a repository), but for the primary tracker, I have implemented an automated approach. Hopefully someone can benefit from this post!\n\n:::{.callout-note}\nThis is not a post detailing every possible approach to using GitHub Actions and Quarto. This is just my implementation given my stack.\n:::\n\n#### My Stack for My Quarto Site\n\nI build a static site with Quarto, then I keep this site in a [repository on GitHub](https://github.com/acbass49/personal_quarto_site). I have connected this repository to [Netlify](https://www.netlify.com/) which redeploys my site when new changes are pushed to the repository.\n\n#### Insert Code that Rerenders in Quarto Document\n\nFor this particular project, I wanted to have a daily update of the Google Trends search scores of GOP candidates. So, in my quarto document, i have an Rscript that uses the `gtrendsr` package to pull the latest data every time the document is rendered. So, to complete our task, we just need the remote environment to simply rerender the site and push to the repository. Here is a snippet of an Rscript in a code chunk inside the quarto document which grabs the data and creates a figure:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(gtrendsR)\nlibrary(ggplot2)\nlibrary(ggstream)\nlibrary(showtext)\nfont_add_google(\"Cairo\", family = \"Cairo\")\nshowtext_auto()\n\nobj <- gtrends(\n    keyword = c(\"Donald Trump\", \"Ron DeSantis\", \"Mike Pence\", \"Nikki Haley\", \"Vivek Ramaswamy\"),\n    time = paste(\"2023-01-01\",as.character(Sys.Date())),\n    geo = \"US\",\n    onlyInterest = TRUE\n)\n\ndf <- obj$interest_over_time\n\ndf$hits <- as.numeric(ifelse(df$hits == \"<1\", \"0.5\", df$hits))\n\ncols <- c(\"cadetblue3\", \"cornsilk3\", \"coral\", \"lightgoldenrod2\", \"palegreen3\")\n\nggplot(df, aes(x = as.Date(date), y = hits, fill = keyword)) +\n    geom_stream(type = \"mirror\") + \n    scale_fill_manual(values = cols) + \n    ggtitle(\"Search Popularity Since January 2023\") +\n    xlab(\"Year 2023\") +\n    ylab(\"Google Search Hits\") +\n    theme(\n        axis.ticks = element_blank(),\n        axis.title = element_text(size = 18, face = \"bold\"),\n        axis.text.y = element_blank(),\n        axis.text.x = element_text(vjust = 2, size = 12, face = \"bold\"),\n        panel.background = element_blank(),\n        text = element_text(face = \"bold\", family = \"Cairo\"),\n        plot.title = element_text(size = 22, face = \"bold\"),\n        legend.title = element_text(face = \"bold\", size = 16, family = \"Cairo\"),\n        plot.caption = element_text(hjust = 2.55, size = 10, face = \"italic\")\n    ) + \n    scale_x_date(date_labels=\"%b\",date_breaks = \"1 month\") + \n    guides(fill=guide_legend(title=\"Keyword\"))\n```\n:::\n\n\n#### GitHub Actions Portion\n\nYou'll notice when you navigate to a github repository, there is a tab entitled `Actions`. After clicking on this tab, you should see some files that you can choose as starters. I don't recall which template I used. I believe they had one for R which was the one that I used.\n\nI will paste my `.yml` file I used for my configuration. Feel free to copy, paste, and edit to your liking.\n\n\n::: {.cell}\n\n```{.yaml .cell-code}\nname: 'Update Stream Graphs'\n\non:\nschedule:\n    - cron: \"0 12 * * *\"\njobs:\nquarto-rerender:\n    runs-on: macos-latest\n    steps:\n    - name: Check out repository\n        uses: actions/checkout@v3\n        with:\n        token: ${{ secrets.SECRETS }}\n    - name: Set up Quarto\n        uses: quarto-dev/quarto-actions/setup@v2\n        with:\n        version: \"1.3.433\"\n    - name: Install R\n        uses: r-lib/actions/setup-r@v2\n        with:\n        r-version: '4.2.0'\n    - uses: r-lib/actions/setup-r-dependencies@v2\n        with:\n        packages:\n            any::readr\n            any::ggplot2\n            any::ggstream\n            any::rmarkdown\n            any::showtext\n            any::knitr\n            any::gtrendsR\n    - name: clone personal site\n        run: |\n        git config --global user.name \"github actions\"\n        git config --global user.email \"acbass49@gmail.com\"\n        git clone \"https://github.com/acbass49/personal_quarto_site.git\"\n        shell: bash\n    - name: re-render site\n        run: |\n        cd personal_quarto_site\n        quarto render\n        shell: bash\n    - name: push new version\n        run: |\n        cd personal_quarto_site\n        git remote set-url origin https://x-access-token:${{ secrets.SECRETS }}@github.com/acbass49/personal_quarto_site.git\n        git add .\n        git commit -m \"StreamGraph Update\"\n        git push\n        shell: bash\n```\n:::\n\n\nThis file is found in [my website repository](https://github.com/acbass49/personal_quarto_site).\n\nA few callouts and things I tweeked along the way...\n\n1. I had a difficult time finding a resource that let me push remotely to a github repository, but this seemed to do the trick `git remote set-url origin https://x-access-token:${{ secrets.SECRETS }}@github.com/acbass49/personal_quarto_site.git`. The `${{ secrets.SECRETS }}` portion is an environment variable that is a github [Personal Access Token](https://docs.github.com/en/authentication/keeping-your-account-and-data-secure/managing-your-personal-access-tokens). You will have to create a personal access token and insert this into a repository environment variable. \n2. Many continuous deployment files run on Ubuntu, but I was having issues getting my figures to be correctly sized as I originally created the figures on a mac, so I used `macos-latest` instead which solved this problem.\n3. For a time, I was having issues with the deployed version being significantly different from my local version. To solve this problem, I made sure to use the `version` argument with Quarto and matched it to my local version. So make sure to match those if possible!\n4. If you are unfamiliar with cron timing, there are several calculators online. My cron time is set to run every morning (I think around 6am EST).\n\n:::{.callout-warning}\nI am by no means an expert at this (feel free to suggest even further efficiencies to what I already have), but I hope that this will benefit someone who was in a similar position as me.\n:::\n\n<div id=\"disqus_thread\"></div>\n<script>\n    /**\n    *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.\n    *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables    */\n    var disqus_config = function () {\n    this.page.url = 'https://alexbass.me/posts/cicd_primary/';  // Replace PAGE_URL with your page's canonical URL variable\n    this.page.identifier = 'cicd_primary'; // Replace PAGE_IDENTIFIER with your page's unique identifier variable\n    };\n    (function() { // DON'T EDIT BELOW THIS LINE\n    var d = document, s = d.createElement('script');\n    s.src = 'https://alexbassc.disqus.com/embed.js';\n    s.setAttribute('data-timestamp', +new Date());\n    (d.head || d.body).appendChild(s);\n    })();\n</script>\n<noscript>Please enable JavaScript to view the <a href=\"https://disqus.com/?ref_noscript\">comments powered by Disqus.</a></noscript>\n\n<script id=\"dsq-count-scr\" src=\"//alexbassc.disqus.com/count.js\" async></script>\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}